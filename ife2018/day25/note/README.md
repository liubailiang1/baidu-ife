# day25~27 

## 1. 执行环境及其作用域

### 1.1 执行环境

全局执行环境: web浏览器为window对象

> 最外层定义的函数变量、所有未定义直接赋值的变量、window对象的属性方法

局部(函数)执行环境: 每个函数都有自己的执行环境

### 1.2 作用域链

变量对象(VO): 函数创建阶段。所有的变量和函数的声明，包含:

* 变量
* 函数声明
* 函数的形参

活动对象(AO): 函数执行阶段的执行上下文, 包含所需的所有变量, 包含:

* 函数的所有局部变量
* 函数的所有命名参数
* 函数的参数集合(arguments)
* 函数的this指向

作用域链: 当前执行代码所在环境的**变量对象**(函数: 活动对象), 经过一个又一个包含环境, 一直延续到全局执行环境

**创建函数时**，会创建一个包含`全局变量对象`的作用域链，保存在`[[Scope]]`属性中  
**调用函数时**，函数会创建一个执行环境，复制函数的`[[Scope]]`属性，并有`活动对象`被创建并推入执行环境作用域链  
**函数执行完毕后**，活动对象被销毁(除闭包)，只剩下全局作用域

延长作用域链: try-catch的catch块、with

### 1.3 块级作用域

JavaScript**没有**块级作用域! 

使用var声明的变量会自动被添加到**最接近的环境**中, 若没用var声明则添加到**全局环境**

若局部环境有同名标识符则不会使用父环境的标识符

### 1.4 声明提前

函数内的变量**声明**将被提前至函数体顶部, 但变量初始化还在以前的位置

## 2. 函数

### 2.1 函数定义

```javascript
// 函数声明语法定义
function sum(num1, num2) {
	return num1 + num2;
}
// 函数表达式定义
var sum = function(num1, num2) {
	return num1 + num2;
};
//Function构造函数
var sum = new Function("num1", "num2", "return num1 + num2"); //不推荐
```

> 函数声明和函数表达式: 函数声明在执行任何代码之前可用; 函数表达式必须等到解析器执行到他所在代码行，才会被执行

注意: 

1. 函数表达式中function后可以没有函数名, 之后要加上`;`
2. 函数是对象, 函数名是指针
3. `return`用于函数停止执行并返回其表达式的值给调用者, 若没有return则返回`undefined`
4. 语句声明定义的函数不能出现在循环、条件、try/cache/finally/with中

### 2.2 函数调用

> 函数调用、方法调用、构造函数调用、间接调用

**this的指向**:

> 原则: this指的是调用函数的对象

情况|this指向
---|---
函数调用|全局对象window
方法调用|上级对象
构造函数调用|生成的新对象
apply调用|apply()的第一个参数

说明:

1. 构造函数调用若没形参可省略括号
2. 嵌套函数若为`方法调用`, this指向调用它的`对象`; 若为`函数调用`, 指向`全局对象/undefined`

### 2.3 函数中的实参和形参

* 当形参大于实参, 多余的形参将设置为`undefined`
* 当实参大于形参, `arguments`类数组对象解决问题

arguments属性:

属性|说明
---|---
length|长度
callee|指向拥有arguments的函数（非严格模式）

### 2.4 作为值的函数

> 函数名是变量, 函数可以作为值来使用。不仅可以把函数传递给另一个函数, 可以将一个函数作为另一个函数的结果返回

在Array.sort()方法使用较多

### 2.5 作为命名空间的函数

> 在命名空间内定义的变量都不会污染到全局命名空间

```javascript
//第一个()将函数变成表达式, 第二个()执行了这个函数
(function() {

})();

(function() {

}());
//以上两种方式都可以
```

### 2.6 函数属性、方法

属性:

属性|说明
---|---
length|期望传入函数的实参个数
prototype|指向"原型对象"的引用

方法:

属性|说明
---|---
apply()|在【参数1】作用域上，调用函数，参数为【参数2(数组)】
call()|在【参数1】作用域上，调用函数，参数为【参数2~n】
bind()|创建一个this值绑定到【参数】的函数实例
toString()/  toLocaleString()|函数代码
valueOf()|函数代码

### 2.7 闭包

> 能够读取其他函数内部变量的函数

作用:

① 访问函数内部的变量  
② 让变量的值始终存在内存中(执行环境的作用域链被销毁了，但活动对象任然会存在内存中)

注意: 

返回函数不要引用任何循环变量，或者后续会发生变化的变量。